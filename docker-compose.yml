version: '3.8'

services:
  tarl-pratham:
    image: tarl-pratham:latest
    container_name: tarl-pratham
    restart: unless-stopped

    # Port mapping - bind to host's network
    ports:
      - "10.1.73.82:3006:3006"

    # Environment variables
    environment:
      - NODE_ENV=production
      - PORT=3006
      - HOSTNAME=0.0.0.0
      - NODE_OPTIONS=--max-old-space-size=2048
      - NEXT_TELEMETRY_DISABLED=1

    # Mount .env file for database credentials
    env_file:
      - .env

    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3006/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

    # Resource limits (important for 1.8GB RAM server)
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1024M
        reservations:
          cpus: '0.5'
          memory: 512M

    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

    # Network mode - use host network for database connectivity
    network_mode: bridge

networks:
  default:
    name: tarl-pratham-network

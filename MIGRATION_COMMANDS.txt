╔══════════════════════════════════════════════════════════════════════════════╗
║                   TaRL Pratham → Supabase Migration                         ║
║                         Quick Command Reference                              ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────────┐
│ 🚀 OPTION 1: ONE-COMMAND MIGRATION (Recommended)                            │
└──────────────────────────────────────────────────────────────────────────────┘

  ./migrate-to-supabase.sh

  ✓ Runs all steps automatically
  ✓ Interactive with pause points
  ✓ Full error handling
  ✓ Time: 40-80 minutes


┌──────────────────────────────────────────────────────────────────────────────┐
│ 📝 OPTION 2: MANUAL STEP-BY-STEP                                            │
└──────────────────────────────────────────────────────────────────────────────┘

  Step 1: Backup (5-10 min)
  ──────────────────────────
  ./scripts/01_backup_database.sh


  Step 2: Restore (10-30 min)
  ────────────────────────────
  ./scripts/02_restore_to_supabase.sh


  Step 3: Verify (5 min)
  ──────────────────────
  ./scripts/03_verify_migration.sh


  Step 4: Update App (5 min)
  ───────────────────────────
  cp .env .env.backup.$(date +%Y%m%d_%H%M%S)
  cp .env.supabase .env
  npm run db:generate
  npm run dev


┌──────────────────────────────────────────────────────────────────────────────┐
│ 🔧 TESTING COMMANDS                                                          │
└──────────────────────────────────────────────────────────────────────────────┘

  Test Supabase Connection
  ────────────────────────
  PGPASSWORD="QtMVSsu8uw60WRjK" psql \
    -h aws-1-us-east-1.pooler.supabase.com \
    -p 5432 \
    -U postgres.uyrmvvwwchzmqtstgwbi \
    -d postgres \
    -c "SELECT version();"


  Check Table Count
  ─────────────────
  PGPASSWORD="QtMVSsu8uw60WRjK" psql \
    -h aws-1-us-east-1.pooler.supabase.com \
    -p 5432 \
    -U postgres.uyrmvvwwchzmqtstgwbi \
    -d postgres \
    -c "SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'public';"


  Check Key Tables
  ────────────────
  PGPASSWORD="QtMVSsu8uw60WRjK" psql \
    -h aws-1-us-east-1.pooler.supabase.com \
    -p 5432 \
    -U postgres.uyrmvvwwchzmqtstgwbi \
    -d postgres \
    -c "SELECT 'users' as table, COUNT(*) FROM users
        UNION ALL SELECT 'students', COUNT(*) FROM students
        UNION ALL SELECT 'assessments', COUNT(*) FROM assessments;"


┌──────────────────────────────────────────────────────────────────────────────┐
│ 📊 CHECK MIGRATION LOGS                                                      │
└──────────────────────────────────────────────────────────────────────────────┘

  Backup Summary
  ──────────────
  cat ~/tarl-migration-backup/backup_manifest_*.txt


  Restore Log
  ───────────
  cat ~/tarl-migration-backup/restore_*.log | less


  Restore Errors Only
  ───────────────────
  cat ~/tarl-migration-backup/restore_*.log | grep -i error


  Verification Report
  ───────────────────
  cat ~/tarl-migration-backup/verification_*.log | less


  List All Migration Files
  ────────────────────────
  ls -lh ~/tarl-migration-backup/


┌──────────────────────────────────────────────────────────────────────────────┐
│ 🔄 ROLLBACK COMMANDS (If Migration Fails)                                   │
└──────────────────────────────────────────────────────────────────────────────┘

  Quick Rollback
  ──────────────
  cp .env.backup.[TIMESTAMP] .env
  npm run db:generate
  npm run dev


  Find Backup Files
  ─────────────────
  ls -lt .env.backup.* | head -5


┌──────────────────────────────────────────────────────────────────────────────┐
│ 🔗 IMPORTANT LINKS                                                           │
└──────────────────────────────────────────────────────────────────────────────┘

  Supabase Dashboard
  ──────────────────
  https://supabase.com/dashboard/project/uyrmvvwwchzmqtstgwbi

  Database Settings
  ─────────────────
  https://supabase.com/dashboard/project/uyrmvvwwchzmqtstgwbi/settings/database

  API Settings
  ────────────
  https://supabase.com/dashboard/project/uyrmvvwwchzmqtstgwbi/settings/api

  SQL Editor
  ──────────
  https://supabase.com/dashboard/project/uyrmvvwwchzmqtstgwbi/editor


┌──────────────────────────────────────────────────────────────────────────────┐
│ 📁 FILE LOCATIONS                                                            │
└──────────────────────────────────────────────────────────────────────────────┘

  Migration Scripts
  ─────────────────
  ./migrate-to-supabase.sh              (One-command migration)
  ./scripts/01_backup_database.sh       (Step 1: Backup)
  ./scripts/02_restore_to_supabase.sh   (Step 2: Restore)
  ./scripts/03_verify_migration.sh      (Step 3: Verify)

  Configuration Files
  ───────────────────
  .env.supabase                         (New Supabase config)
  .env.supabase.template                (Template)
  .env                                  (Current active config)
  .env.backup.*                         (Backup configs)

  Documentation
  ─────────────
  MIGRATION_READY.md                    (Quick start)
  docs/MIGRATION_TO_SUPABASE.md         (Full guide)
  docs/SUPABASE_MIGRATION_QUICK_START.md (Quick reference)
  MIGRATION_COMMANDS.txt                (This file)

  Migration Data
  ──────────────
  ~/tarl-migration-backup/              (All backup/restore files)
    ├── tarl_pratham_*.dump             (Main backup)
    ├── tarl_pratham_*.sql              (SQL backup)
    ├── tarl_pratham_schema_*.sql       (Schema only)
    ├── backup_manifest_*.txt           (Backup summary)
    ├── restore_*.log                   (Restore log)
    ├── verification_*.log              (Verification log)
    └── .env.supabase                   (Generated config)


┌──────────────────────────────────────────────────────────────────────────────┐
│ 🔑 CREDENTIALS (Already Configured)                                          │
└──────────────────────────────────────────────────────────────────────────────┘

  Database
  ────────
  Host:     aws-1-us-east-1.pooler.supabase.com
  User:     postgres.uyrmvvwwchzmqtstgwbi
  Password: QtMVSsu8uw60WRjK
  Database: postgres
  Port:     5432 (Session) / 6543 (Transaction)

  Project
  ───────
  Project ID: uyrmvvwwchzmqtstgwbi
  URL:        https://uyrmvvwwchzmqtstgwbi.supabase.co

  API Keys
  ────────
  ✓ Anon Key loaded
  ✓ Service Role Key loaded
  ✓ JWT Secret loaded


┌──────────────────────────────────────────────────────────────────────────────┐
│ ⚙️  CONNECTION MODES                                                         │
└──────────────────────────────────────────────────────────────────────────────┘

  Session Mode (Port 5432) - For migrations
  ──────────────────────────────────────────
  postgres://postgres.uyrmvvwwchzmqtstgwbi:QtMVSsu8uw60WRjK@aws-1-us-east-1.pooler.supabase.com:5432/postgres

  Transaction Mode (Port 6543) - For application
  ───────────────────────────────────────────────
  postgres://postgres.uyrmvvwwchzmqtstgwbi:QtMVSsu8uw60WRjK@aws-1-us-east-1.pooler.supabase.com:6543/postgres?pgbouncer=true


┌──────────────────────────────────────────────────────────────────────────────┐
│ ✅ POST-MIGRATION CHECKLIST                                                  │
└──────────────────────────────────────────────────────────────────────────────┘

  [ ] Migration completed without critical errors
  [ ] Verification passed all checks
  [ ] Application starts successfully (npm run dev)
  [ ] Login works (email/password)
  [ ] Quick login works (username)
  [ ] Students list loads
  [ ] Can create/edit student
  [ ] Assessments list loads
  [ ] Can create/edit assessment
  [ ] Dashboard displays correctly
  [ ] Reports generate successfully
  [ ] No console errors
  [ ] Old .env backed up
  [ ] Migration logs saved


┌──────────────────────────────────────────────────────────────────────────────┐
│ 🆘 TROUBLESHOOTING                                                           │
└──────────────────────────────────────────────────────────────────────────────┘

  Connection Timeout
  ──────────────────
  • Check Supabase dashboard → Settings → Database → Network
  • Verify IP is allowed
  • Try port 5432 instead of 6543

  Table Count Mismatch
  ────────────────────
  • Check restore log for errors
  • Re-run restore script
  • Verify backup file integrity

  Application Won't Start
  ───────────────────────
  • Verify DATABASE_URL in .env
  • Check port is 6543 with ?pgbouncer=true
  • Run: npm run db:generate
  • Check: npm run dev output for errors


╔══════════════════════════════════════════════════════════════════════════════╗
║  Ready to migrate? Run: ./migrate-to-supabase.sh                            ║
╚══════════════════════════════════════════════════════════════════════════════╝
